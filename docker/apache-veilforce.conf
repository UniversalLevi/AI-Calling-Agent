<VirtualHost *:80>
    ServerName veilforce.com
    ServerAlias www.veilforce.com

    ProxyPreserveHost On
    ProxyRequests Off

    # Dashboard API - MUST come before frontend catch-all
    ProxyPass /api http://localhost:5016/api
    ProxyPassReverse /api http://localhost:5016/api

    # Voice bot endpoints - MUST come before frontend catch-all
    ProxyPass /voice http://localhost:5015/voice
    ProxyPassReverse /voice http://localhost:5015/voice

    ProxyPass /status http://localhost:5015/status
    ProxyPassReverse /status http://localhost:5015/status

    # Audio server - MUST come before frontend catch-all
    ProxyPass /audio http://localhost:5018/audio
    ProxyPassReverse /audio http://localhost:5018/audio

    # Frontend - Proxy to Docker container (catch-all, must be last)
    ProxyPass / http://localhost:5017/
    ProxyPassReverse / http://localhost:5017/

    ErrorLog ${APACHE_LOG_DIR}/veilforce-error.log
    CustomLog ${APACHE_LOG_DIR}/veilforce-access.log combined

    RewriteEngine on
    RewriteCond %{SERVER_NAME} =www.veilforce.com [OR]
    RewriteCond %{SERVER_NAME} =veilforce.com
    RewriteRule ^ https://%{SERVER_NAME}%{REQUEST_URI} [END,NE,R=permanent]
</VirtualHost>


