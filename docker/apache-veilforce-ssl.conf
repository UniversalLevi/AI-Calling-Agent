<IfModule mod_ssl.c>
<VirtualHost *:443>
    ServerName veilforce.com
    ServerAlias www.veilforce.com

    ProxyPreserveHost On
    ProxyRequests Off

    # Enable WebSocket support for Socket.io
    RewriteEngine On
    RewriteCond %{HTTP:Upgrade} websocket [NC]
    RewriteCond %{HTTP:Connection} upgrade [NC]
    RewriteRule ^/socket.io/(.*) ws://localhost:5016/socket.io/$1 [P,L]

    # Socket.io - MUST come before API (more specific path)
    ProxyPass /socket.io http://localhost:5016/socket.io
    ProxyPassReverse /socket.io http://localhost:5016/socket.io

    # Dashboard API - MUST come before frontend catch-all
    ProxyPass /api http://localhost:5016/api
    ProxyPassReverse /api http://localhost:5016/api

    # Voice bot endpoints - MUST come before frontend catch-all
    ProxyPass /voice http://localhost:5015/voice
    ProxyPassReverse /voice http://localhost:5015/voice

    ProxyPass /status http://localhost:5015/status
    ProxyPassReverse /status http://localhost:5015/status

    # Audio server - MUST come before frontend catch-all
    ProxyPass /audio http://localhost:5018/audio
    ProxyPassReverse /audio http://localhost:5018/audio

    # Frontend - Proxy to Docker container (catch-all, must be last)
    ProxyPass / http://localhost:5017/
    ProxyPassReverse / http://localhost:5017/

    ErrorLog ${APACHE_LOG_DIR}/veilforce-error.log
    CustomLog ${APACHE_LOG_DIR}/veilforce-access.log combined

    Include /etc/letsencrypt/options-ssl-apache.conf
    SSLCertificateFile /etc/letsencrypt/live/veilforce.com/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/veilforce.com/privkey.pem
</VirtualHost>
</IfModule>


